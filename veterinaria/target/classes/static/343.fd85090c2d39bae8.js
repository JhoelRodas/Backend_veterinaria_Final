"use strict";(self.webpackChunkfury=self.webpackChunkfury||[]).push([[343],{19343:(Q,D,l)=>{l.r(D),l.d(D,{DetallesVentaModule:()=>Z});var p=l(60177),f=l(18498),s=l(89417),m=l(9159),t=l(17705),F=l(97405),j=l(74061),E=l(75063),u=l(88834),b=l(82765),v=l(99213),d=l(59115),y=l(96695),h=l(2042),P=l(43655),R=l(53007),N=l(15551),g=l(52920),C=l(86467),k=l(99631),V=l(86600),x=l(82798);function S(o,c){if(1&o&&(t.j41(0,"mat-option",27),t.EFF(1),t.k0s()),2&o){const e=c.$implicit;t.Y8G("value",e.id),t.R7$(1),t.SpI(" ",e.nombre," ")}}function $(o,c){1&o&&(t.j41(0,"th",28)(1,"mat-checkbox",29),t.bIt("click",function(n){return n.stopPropagation()}),t.k0s()())}function I(o,c){1&o&&(t.j41(0,"td",30)(1,"mat-checkbox",29),t.bIt("click",function(n){return n.stopPropagation()}),t.k0s()())}function T(o,c){if(1&o&&(t.j41(0,"th",35),t.EFF(1),t.k0s()),2&o){const e=t.XpG(2).$implicit;t.R7$(1),t.SpI(" ",e.name,"")}}function G(o,c){if(1&o&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&o){const e=c.$implicit,n=t.XpG(2).$implicit;t.R7$(1),t.SpI(" ",e[n.property]," ")}}function _(o,c){if(1&o&&(t.qex(0,32),t.DNE(1,T,2,1,"th",33),t.DNE(2,G,2,1,"td",34),t.bVm()),2&o){const e=t.XpG().$implicit;t.Y8G("matColumnDef",e.property)}}function M(o,c){if(1&o&&(t.qex(0),t.DNE(1,_,3,1,"ng-container",31),t.bVm()),2&o){const e=c.$implicit;t.R7$(1),t.Y8G("ngIf",e.isModelProperty)}}function Y(o,c){1&o&&t.nrm(0,"th",37)}function U(o,c){if(1&o){const e=t.RV6();t.j41(0,"td",30)(1,"button",38),t.bIt("click",function(a){return a.stopPropagation()}),t.j41(2,"mat-icon"),t.EFF(3,"more_horiz"),t.k0s()(),t.j41(4,"mat-menu",39,40)(6,"button",41),t.bIt("click",function(){const i=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.updateDetalle(i))}),t.j41(7,"span"),t.EFF(8,"Modify"),t.k0s()(),t.j41(9,"button",41),t.bIt("click",function(){const i=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.deleteDetalle(i))}),t.j41(10,"span"),t.EFF(11,"Delete"),t.k0s()()()()}if(2&o){const e=t.sdS(5);t.R7$(1),t.Y8G("matMenuTriggerFor",e)}}function L(o,c){1&o&&t.nrm(0,"tr",42)}function z(o,c){if(1&o){const e=t.RV6();t.j41(0,"tr",43),t.bIt("click",function(){const i=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.updateDetalle(i))}),t.k0s()}}const X=function(){return["Detalles"]},B=function(){return[]},H=[{path:"",component:(()=>{class o{constructor(e,n){this.apiClient=e,this.router=n,this.productosList=[],this.detalles=[],this.dataSource=new m.I6([]),this.columns=[{name:"ID Producto",property:"idProducto",visible:!0,isModelProperty:!0},{name:"Cantidad",property:"cant",visible:!0,isModelProperty:!0},{name:"Monto",property:"monto",visible:!0,isModelProperty:!0},{name:"Actions",property:"actions",visible:!0}],this.pageSize=10,this.form=new s.J3({idProducto:new s.hs(""),cant:new s.hs(""),cliente:new s.hs(""),ciCliente:new s.hs(""),extension:new s.hs(""),stock:new s.hs({value:0,disabled:!0}),precioUnitario:new s.hs({value:0,disabled:!0})})}get visibleColumns(){return this.columns.filter(e=>e.visible).map(e=>e.property)}ngOnInit(){this.apiClient.getRequest("/api/producto").subscribe({next:e=>{this.productosList=e,console.info(e)},error:e=>{console.error(e)}}),this.form.get("idProducto")?.valueChanges.subscribe(e=>{this.actualizarCamposProducto(e)}),this.form.get("cant")?.valueChanges.subscribe(()=>{this.actualizarMonto()})}agregarDetalle(){const{idProducto:e,cant:n}=this.form.getRawValue(),a=this.productosList.find(r=>r.id===e);if(!a)return void console.error("Producto no encontrado o no seleccionado");a.stock=a.stock-n,this.apiClient.putRequest("/api/producto",a.id,a).subscribe({next:r=>{console.log(r)},error:r=>{console.error("Error al actualizar  producto:",r)}});const i=this.detalles.find(r=>r.idProducto===e);console.log("detalleExistente",i),i?(i.cant=Number(i.cant)+Number(n),i.monto=Number(i.cant)*Number(a.precioUnitario)):this.detalles.push({idProducto:e,cant:n,monto:n*a.precioUnitario}),console.log("detalles",this.detalles),this.dataSource.data=[...this.detalles],this.form.patchValue({idProducto:null,cant:0,precioUnitario:0,stock:0})}guardarDetalles(){const e=this.form.get("cliente")?.value,n=this.form.get("ciCliente")?.value,a=this.form.get("extension")?.value,i={nombre:e,ci:n,extension:a,detalles:this.detalles,montoTotal:0,metodoPago:"efectivo"};console.log(i),this.apiClient.postRequest("/api/recibo",i).subscribe({next:r=>{console.info("Detalles guardados correctamente:",r),this.router.navigate(["ventas/venta"])},error:r=>{console.error("Error al guardar los detalles:",r)}})}actualizarCamposProducto(e){const n=this.productosList.find(a=>a.id===e);console.log(n),this.form.patchValue(n?{precioUnitario:n.precioUnitario,stock:n.stock}:{precioUnitario:0,stock:0})}actualizarMonto(){this.form.get("cant"),this.form.get("precioUnitario");this.form.patchValue({monto:this.form.value})}updateDetalle(e){}deleteDetalle(e){console.log("row",e),console.log("ListPro",this.productosList);const n=this.productosList.find(a=>a.id===e.idProducto);this.detalles=this.detalles.filter(a=>a.id!==e.idProducto),console.log("producto",n),console.log("detalles",this.detalles),n.stock=Number(n.stock)+Number(e.cant),this.apiClient.putRequest("/api/producto",n.id,n).subscribe({next:a=>{console.log(a),this.apiClient.getRequest("/api/producto").subscribe({next:i=>{this.productosList=i,console.info(i)},error:i=>{console.error(i)}}),this.dataSource.data=this.dataSource.data.filter(i=>i.idProducto!==e.idProducto)},error:a=>{console.error("Error al actualizar  producto:",a)}})}onFilterChange(e){console.info(event),this.dataSource&&(e=(e=e.trim()).toLowerCase(),this.dataSource.filter=e)}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(F.f),t.rXU(f.Ix))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["fury-detalles-venta"]],decls:53,vars:11,consts:[["mode","card"],["current","Detalle",3,"crumbs"],["name","Detalle",3,"columns","filterChange"],["fxLayout","row wrap",3,"formGroup"],["fxFlex",""],["type","text","formControlName","cliente","matInput",""],["type","text","formControlName","ciCliente","matInput",""],["type","text","formControlName","extension","matInput",""],["formControlName","idProducto"],[3,"value",4,"ngFor","ngForOf"],["type","text","matInput","","formControlName","stock","readonly",""],["type","text","matInput","","formControlName","precioUnitario","readonly",""],["type","text","formControlName","cant","matInput",""],[1,"actions"],["type","button","mat-mini-fab","","color","primary",1,"create",3,"click"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","checkbox"],["class","actions-cell","mat-header-cell","",4,"matHeaderCellDef"],["class","actions-cell","mat-cell","",4,"matCellDef"],[4,"ngFor","ngForOf"],["matColumnDef","actions"],["class","actions-cell","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[2,"margin-top","20px","text-align","right"],["mat-raised-button","","color","primary",3,"click"],[3,"value"],["mat-header-cell","",1,"actions-cell"],["color","primary",3,"click"],["mat-cell","",1,"actions-cell"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell","","mat-sort-header","",1,"actions-cell"],["type","button","mat-icon-button","",3,"matMenuTriggerFor","click"],["yPosition","below","xPosition","before"],["actionsMenu","matMenu"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements",3,"click"]],template:function(n,a){1&n&&(t.j41(0,"fury-page-layout",0)(1,"fury-page-layout-header"),t.nrm(2,"fury-breadcrumbs",1),t.k0s(),t.j41(3,"fury-page-layout-content")(4,"fury-list",2),t.bIt("filterChange",function(r){return a.onFilterChange(r)}),t.j41(5,"div",3)(6,"mat-form-field",4)(7,"mat-label"),t.EFF(8,"cliente"),t.k0s(),t.nrm(9,"input",5),t.k0s(),t.j41(10,"mat-form-field",4)(11,"mat-label"),t.EFF(12,"ciCliente"),t.k0s(),t.nrm(13,"input",6),t.k0s(),t.j41(14,"mat-form-field",4)(15,"mat-label"),t.EFF(16,"Extension"),t.k0s(),t.nrm(17,"input",7),t.k0s(),t.j41(18,"mat-form-field")(19,"mat-label"),t.EFF(20,"Productos"),t.k0s(),t.j41(21,"mat-select",8),t.DNE(22,S,2,2,"mat-option",9),t.k0s()(),t.j41(23,"mat-form-field",4)(24,"mat-label"),t.EFF(25,"Stock"),t.k0s(),t.nrm(26,"input",10),t.k0s(),t.j41(27,"mat-form-field",4)(28,"mat-label"),t.EFF(29,"Precio"),t.k0s(),t.nrm(30,"input",11),t.k0s(),t.j41(31,"mat-form-field",4)(32,"mat-label"),t.EFF(33,"Cantidad"),t.k0s(),t.nrm(34,"input",12),t.k0s(),t.j41(35,"div",13)(36,"button",14),t.bIt("click",function(){return a.agregarDetalle()}),t.j41(37,"mat-icon"),t.EFF(38,"add"),t.k0s()()()(),t.j41(39,"table",15),t.qex(40,16),t.DNE(41,$,2,0,"th",17),t.DNE(42,I,2,0,"td",18),t.bVm(),t.DNE(43,M,2,1,"ng-container",19),t.qex(44,20),t.DNE(45,Y,1,0,"th",21),t.DNE(46,U,12,1,"td",18),t.bVm(),t.DNE(47,L,1,0,"tr",22),t.DNE(48,z,1,0,"tr",23),t.k0s(),t.nrm(49,"mat-paginator",24),t.k0s(),t.j41(50,"div",25)(51,"button",26),t.bIt("click",function(){return a.guardarDetalles()}),t.EFF(52," Guardar y Volver a Recibos "),t.k0s()()()()),2&n&&(t.R7$(2),t.Y8G("crumbs",t.lJ4(9,X)),t.R7$(2),t.Y8G("columns",t.lJ4(10,B)),t.R7$(1),t.Y8G("formGroup",a.form),t.R7$(17),t.Y8G("ngForOf",a.productosList),t.R7$(17),t.Y8G("dataSource",a.dataSource),t.R7$(4),t.Y8G("ngForOf",a.columns),t.R7$(4),t.Y8G("matHeaderRowDef",a.visibleColumns),t.R7$(1),t.Y8G("matRowDefColumns",a.visibleColumns),t.R7$(1),t.Y8G("pageSize",a.pageSize))},dependencies:[p.Sq,p.bT,j.m,E.s,u.$z,u.iY,u.$0,b.So,v.An,d.kk,d.fb,d.Cp,y.iy,h.B4,h.aE,m.Zl,m.tL,m.ji,m.cC,m.YV,m.iL,m.KS,m.$R,m.YZ,m.NB,P.T,R.M,N.M,g.DJ,g.UI,s.me,s.BC,s.cb,C.rl,C.nJ,k.fg,V.wT,x.VO,s.j4,s.JD]})}}return o})()}];let O=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[f.iI.forChild(H),f.iI]})}}return o})();var w=l(3632),J=l(91398),A=l(49320);let Z=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[p.MD,O,w.V,J.H,u.Hl,b.g7,v.m_,d.Cn,y.Ou,h.NQ,m.tP,A.S,g.w2,s.YN,C.RG,k.fS,V.Sy,x.Ve,s.X1]})}}return o})()}}]);